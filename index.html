<html>
<head>
   <title>Visual BrainF*ck</title>
   <script src="bf.js" type="text/javascript"></script>
   <script src="jquery.js" type="text/javascript"></script>
   <style type="text/css">
      .error { color: pink; }
      .current { background-color: yellow; font-weight: bold; }
      #debug {
        float: right;
        width: 300px;
      }
      #debug ul {
       display: inline;
       list-style: none;
      }
      #debug li { 
       display: block;
       float: left;
       padding: 2px;
      }
      #instructions { clear: both; }
      #heap { clear: both; }
      #editor {
       float: left;
       width: 600px;
       height: 100%;
      }
      #toolbar {
       height: 30px;
      }
      #codecontainer {
       width: 100%;
       height: 80%;
      }
      #codecontainer textarea {
       width: 95%;
       height: 95%;
      }
      #console {
       overflow: auto;
       height: 10%;
      }
      .break {
       background-color: pink;
      }
      h3 {
       padding: 0;
       margin: 0;
      }
   </style>
</head>
<body>
   <div id="wrapper">
      <div id="debug">
         <h3>Registers</h3>
         <div>
            <strong>DP:</strong> <span id="dp"></span><br />
            <strong>PC:</strong> <span id="pc"></span><br />
         </div>
         <h3>Instructions</h3>
         <div id="instructions">
         </div>
         <br clear="both" />
         <h3>Heap</h3>
         <div id="heap">
         </div>
      </div>
      <div id="editor">
         <div id="toolbar">
            <button id="run">run</button>
            <button id="step">step</button>
            <button id="load">load</button>
            <button id="reset">reset</button>
         </div>
         <div id="codecontainer">
            <textarea id="code">++++++++++[&gt;+++++++&gt;++++++++++&gt;+++&gt;+<<<<-]&gt;++.&gt;+.+++++++..+++.&gt;++.<<+++++++++++++++.&gt;.+++.------.--------.&gt;+.&gt;.</textarea>
                                                                                                                            </div>
         <h3>Console</h3>
         <div id="console">
         </div>
      </div>
   </div>
   <script type="text/javascript">
//<![CDATA[
function getinput() {
  var x = prompt('Enter a value: (0xFF or single character)', 'Byte');
  if (x === '') {
    return 0;
  }
  else if (x[1] === 'x') {
    return Integer.parseInt(x, 16);
  }
  else {
    return x.charCodeAt(0);
  }
}

function preexec(bf) {
  var i;
  var html = '<ul>';
  var code = bf.code();
  var heap = bf.heap();

  for (var i = 0; i < code.length; i++) {
    html += '<li class="instruction" id="pc-' + i + '" title="code offset: ' + i + '">' + code[i] + '</li>';
  }
  $("#instructions").html(html + '</ul>');
  html = '<ul>';
  for (i = 0; i < heap.length; i++) {
    html += '<li id="dp-' + i + '" title="data offset: ' + i + '">' + heap[i] + '</li>';
  }
  $("#heap").html(html + '</ul>');
  $('#dp').html('0');
  $('#pc').html('0');
}
function preinst(bf) {

}
function postinst(bf) {
  $("#pc-" + bf.lastPC()).removeClass('current');
  $("#dp-" + bf.lastDP()).removeClass('current');
  $("#dp-" + bf.currentDP()).html(bf.currentAtDP()).addClass('current');
  $("#pc-" + bf.currentPC()).addClass('current');
  $('#dp').text(bf.currentDP());
  $('#pc').text(bf.currentPC());
}
function onerror(bf, msg) {
  $('#console').append('<p class="error">' + msg + '</p>');
}
function output(b) {
  $('#console').text($('#console').text() + String.fromCharCode(b));
}

jQuery(function($) {
  var bf = new BrainFuck(getinput, output, 512);
  bf.onerror = onerror;
  bf.onpreinst = preinst;
  bf.onpostinst = postinst;
  bf.onpreexec = preexec;

  $('#run').click(function () {
    if (bf.status() == BrainFuckStatus.STOPPED) {
      bf.load($('#code').val());
    }
    bf.exec();
  });
  $('#step').click(function () {
    if (bf.status() == BrainFuckStatus.STOPPED) {
      bf.load($('#code').val());
    }
    bf.step();
  });
  $('#reset').click(function () {
    bf.load('');
  });
  $('#load').click(function () {
    bf.load($('#code').val());
  });

  $('.instruction').live('click', function() {
    var t = $(this);
    var pc = t.attr('id').replace('pc-', '');;
    t.toggleClass('break');
    bf.toggleBreakPoint(parseInt(pc));
  });
});
//]]>
   </script>
</body>
</html>
